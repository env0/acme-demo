version: 1

deploy:
  steps:
    terraformPlan:
      before:
        - terraform plan -out .tf-plan
        - terraform show -json .tf-plan > tf-plan.json
        - cat tf-plan.json | jq '.resource_changes [] | select ( .change.actions[] | contains ("delete") )'
        - ./checkfordeletion.sh
