version: 1

deploy:
  steps:
    terraformInit:
      before:
        - pwd
        - aws sts get-caller-identity
        - echo "Replacing !!!USER!!! with $USER in index.html"
        - sed 's/!!!USER!!!/'"$USER"'/g' index.template.html > index.html
    terraformPlan:
      after:
        - cat $ENV0_TF_PLAN_JSON
    terraformOutput:
      after:
        -  aws s3api delete-bucket-tagging --bucket $(terraform output -raw bucketname)
destroy:
  steps:
    terraformPlan:
      after:
        - cat $ENV0_TF_PLAN_JSON 