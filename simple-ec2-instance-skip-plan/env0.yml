version: 2
deploy:
  steps:
    terraformPlan:
      after:
        - name: "VMware Skip Test: Check Skip"
          run: |
            echo 'terraform show .tf-plan | grep -i "no changes"'
            if [ $('terraform show .tf-plan | grep -i "no changes"') ]; then echo "condition accepted" ; fi
    terraformApply:
      before:
        - name: "VMW Skip Test: Before Apply"
          run: |
            echo "value is $(cat tf_plan.log)"
            if [ "$(cat tf_plan.log)" == "0" ]; then echo "No changes, not applying" ; elif [ "$(cat tf_plan.log)" == "2" ] ; then echo "I'm running before the apply"; fi
      after:
        - name: "VMW Skip Test: After Apply"
          run: |
            echo "value is $(cat tf_plan.log)"
            if [ "$(cat tf_plan.log)" == "0" ]; then echo "No changes, not applying" ; elif [ "$(cat tf_plan.log)" == "2" ] ; then echo "I'm running after the apply"; fi
